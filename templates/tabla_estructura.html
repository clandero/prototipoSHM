{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<style>
    #map {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
    }
</style>
<div class="container-fluid">
    <h1 class="title">
        {{datos_puente.tipo_activo}} {{ datos_puente.nombre.capitalize() }}
    </h1>
    <h4 class="subtitle">
        Estado de monitoreo: {{estado_monitoreo.estado}} - {{estado_monitoreo.fecha_estado}}
    </h4>
    <div class="btn-toolbar">
        {% if esta_monitoreada %}
                <form action="{{url_for('views_api.zonas_de_estructura', id=datos_puente.id)}}">
                    <button class="btn btn-secondary btn-sm">Zonas</button>
                </form>
                <form action="{{url_for('views_api.sensores_de_estructura', id=datos_puente.id)}}">
                    <button class="btn btn-secondary btn-sm">Lista de Sensores</button>
                </form>
            {% if current_user.permisos != 'Visita' %}
                    <form action="{{url_for('views_api.historial_monitoreo_estructura', id=datos_puente.id)}}">
                        <button class="btn btn-secondary btn-sm">Historial de monitoreo</button>
                    </form>
                    <form action="{{url_for('views_api.daqs_de_estructura', id_puente=datos_puente.id)}}">
                        <button class="btn btn-secondary btn-sm">DAQs</button>
                    </form>
                    <form action="{{url_for('views_api.clusters_estructura', id_puente=datos_puente.id)}}">
                        <button class="btn btn-secondary btn-sm">Clusters</button>
                    </form>
                    <form action="{{url_for('views_api.show_3d_bim',filename = bim_estructura.ruta_acceso_archivo)}}">
                        <button class="btn btn-secondary btn-sm">Visualización 3D</button>
                    </form>
            {% endif %}
        {% else %}
            {% if current_user.permisos == 'Administrador' %}
                    <form action="{{ url_for('views_api.crear_monitoreo', id_puente=datos_puente.id) }}", method="POST">
                        <button class="btn btn-secondary btn-sm">Iniciar Monitoreo</button>
                    </form>
            {% endif %} 
        {% endif %}
    </div>
    <br>
    <div class="btn-toolbar">
        <form action="{{url_for('views_api.informes_monitoreo_estructura', id_puente=datos_puente.id)}}">
            <button class="btn btn-secondary btn-sm">Informes de monitoreo</button>
        </form>
    </div>
    <div class="row">
        <br>
        <br>
    </div>
    <div class="row">
        <div class="col-md-6">
            <table class="table table-hover clickable-row sortable mw-50">
                <thead>
                    <tr>
                        <th>Ubicación</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Camino</td>
                        <td>{{ datos_puente.nombre_camino }}</td>
                    </tr>
                    <tr>
                        <td>Cauce de quebrada</td>
                        <td>{{ datos_puente.cauce_queb }}</td>
                    </tr>
                    <tr>
                        <td>Provincia</td>
                        <td>{{ datos_puente.provincia }}</td>
                    </tr>
                    <tr>
                        <td>Región</td>
                        <td>{{ datos_puente.region }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-md-6">
            <table class="table table-hover clickable-row sortable">
                <thead>
                    <tr>
                        <th>Características</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Largo</td>
                        <td>{{ datos_puente.largo }} metros</td>
                    </tr>
                    <tr>
                        <td>Ancho total</td>
                        <td>{{ datos_puente.ancho_total }} metros</td>
                    </tr>
                    <tr>
                        <td>Estribo</td>
                        <td>{{ datos_puente.mat_estrib }}</td>
                    </tr>
                    <tr>
                        <td>Cepas</td>
                        {% if datos_puente.num_cepas > 0 %}
                            {% if datos_puente.mat_cepas != 'N/A' and datos_puente.mat_cepas != 'S/I'%}    
                                <td>{{ datos_puente.num_cepas|int }} cepa(s) de {{ datos_puente.mat_cepas }}</td>
                            {% else %}
                                <td>{{datos_puente.num_cepas|int}} cepa(s)</td>
                            {% endif %}
                        {% else %}
                            <td>{{datos_puente.mat_cepas}}</td>
                        {% endif %}
                    </tr>
                    <tr>
                        <td>Piso</td>
                        <td>{{ datos_puente.piso }}</td>
                    </tr>
                    <tr>
                        <td>Vigas</td>
                        <td>{{ datos_puente.mat_vigas }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <br>
        <br>
        <br>
    </div>
    <div class="row">
        <div class="col-md-6">
            {% if imagenes_estructura != None %}
                <div id="carouselExampleSlidesOnly" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        {% for i in imagenes_estructura %}
                            <div class="carousel-item{% if loop.index == 1 %} active{% endif %}">
                                <img class="d-block w-100" src="/static/images/{{i.ruta_acceso_archivo}}" alt="{{i.descripcion}}">
                            </div>
                        {% endfor %}
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleSlidesOnly" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleSlidesOnly" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <div id="map">
                <script>
                    function onMapClick(e) {
                        popup.setLatLng(e.latlng);
                        popup.setContent("Has pulsado en Lat=" + e.latlng.lat + " Long=" + e.latlng.lng);
                        popup.openOn(map);
                    }
                    
                    //var osmLayer = new L.TileLayer('https://api.maptiler.com/maps/basic/{z}/{x}/{y}.png?key=zZkrANgINoCERa0zI6td');
                    var ESRIWorldImageryLayer = new L.TileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');
        
                    var baseMaps = {
                        'ESRI World Imagery': ESRIWorldImageryLayer
                    };
        
                    var layerControl = new L.control.layers(baseMaps);
                    var map = L.map('map');
                    map.setView(new L.LatLng('{{datos_puente.coord_x}}','{{datos_puente.coord_y}}'),17);
                    map.addControl(layerControl);    
                    map.addLayer(ESRIWorldImageryLayer);
        
                    var popup = new L.popup();
                    var marker = L.marker(['{{datos_puente.coord_x}}','{{datos_puente.coord_y}}']).addTo(map);
                    map.on('click', onMapClick);
                </script>
            </div>
            
        </div>
    </div>
</div>
{% endblock %}